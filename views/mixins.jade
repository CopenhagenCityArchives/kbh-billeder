mixin assetMeta(item, sources)
  if item.short_title
    - title = item.short_title
  else
    - title = 'Ingen titel'
  if item.description
    - description = item.description
  if sources.image
    - image = sources.image
    
  - twitterAccount = helpers.getTwitterAccount(item)
  - facebookAppId = helpers.getFacebookAppId(item)

  +meta(title, socialTitle, twitterAccount, facebookAppId, image, description)

mixin searchMeta(result, catalog, breadcrumbs)
  if result.isSearch
    - title = filters.freetext
    - socialTitle = 'Søgning på "' + title + '"'

  if result.isCategory
    if breadcrumbs
      - title = breadcrumbs.last.name
    else
      - title = catalog.name
  if result.isCatalog
    - title = catalog.name
    
  - twitterAccount = helpers.getTwitterAccount()
  - facebookAppId = helpers.getFacebookAppId()

  +meta(title, socialTitle, twitterAccount, facebookAppId)

mixin meta(title, socialTitle, twitterAccount, facebookAppId, image, description)
  - siteTitle = req.app.get('siteTitle')
  - baseUrl = 'https://' + (req.get('x-forwarded-host') || req.get('host'))
  - unsafeBaseUrl = 'http://' + (req.get('x-forwarded-host') || req.get('host'))
  - pageUrl = baseUrl + req.originalUrl
  - twitterCard = 'summary_large_image'
  - facebookType = 'website'

  if title
    - title += ' - ' + siteTitle
  else
    - title = siteTitle

  if socialTitle
    - socialTitle += ' - ' + siteTitle
  else
    - socialTitle = title

  if !description
    - description = 'Søg og udforsk ' + siteTitle

  if image
    - image = unsafeBaseUrl + image
  else
    - image = unsafeBaseUrl + '/images/defaultshare.jpg'

  title #{title}
  meta(name='description', content='#{description}')
  meta(name='twitter:card', content='#{twitterCard}')
  if twitterAccount
    meta(name='twitter:site', content='#{twitterAccount}')
  meta(name='twitter:title', content='#{socialTitle}')
  meta(name='twitter:description', content='#{description}')
  meta(name='twitter:image', content='#{image}')
  meta(property='og:title', content='#{socialTitle}')
  meta(property='og:type', content='#{facebookType}')
  meta(property='og:url', content='#{pageUrl}')
  meta(property='og:image', content='#{image}')
  meta(property='og:description', content='#{description}')
  meta(property='og:site_name', content='#{title}')
  if facebookAppId
    meta(property='fb:app_id', content='#{facebookAppId}')

mixin loader(text)
  if text
    span.text #{text}
  .loader
  .loader.one
  .loader.two

mixin searchCount
  span.search-count &nbsp;#{result.totalCount} poster

mixin recursiveCategoryItem(catalog, category)
  if category.count > 0
    li
      div
        a.col-xs-10(href='/#{catalog.alias}?cat=#{category.id}') #{category.name}
          span #{category.count}
        if category.children.length > 0
          .expand
            +icon('plus')
      if category.children.length > 0
        ul.nav.menu-hidden
          each childCategory in category.children
            +recursiveCategoryItem(catalog, childCategory)

mixin searchResultAsset(asset)
  .box
    a(href='#{asset.link}')
      if asset.type == 'video'
        .video-thumbnail
          .icon
      else
        .image
          .overlay
            img(src='#{asset.thumbnailURL}').rotation
            if asset.type == 'image-rotation'
              +icon('rotation')
      h2.h4 #{asset.title}
      p.description #{asset.description}

mixin icon(id)
  svg
    use(xlink:href='#icon-#{id}')

mixin fullDate(date)
  - var points = []
  - if (date.day && date.month) points.push(date.day)
  - if (date.month) points.push(date.month)
  - if (date.year) points.push(date.year)
  | #{points.join('/')}

mixin formatDate(from, to)
  if(from && to && from.day == to.day && from.month == to.month && from.day == to.day)
    +fullDate(from)
  else
    if(from && to && from.day == 1 && from.month == 1 && to.day == 31 && to.month == 12 && from.year == to.year)
      | #{from.year}
    else
      if(from)
        +fullDate(from)
      if((from && to) || (!from && !to))
        |  -
      if(to)
        +fullDate(to)


mixin tag(name)
  a.btn.btn-default.btn-small(
    href='/?q='+encodeURIComponent(name),
    data-tag=name
  )= name
    if block
      block
