mixin analytics
  //- Tracking for live site (samlinger.natmus.dk)
  if(config.googleAnalyticsPropertyID)
    script.
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', '#{config.googleAnalyticsPropertyID}', 'auto');
      ga('send', 'pageview');

mixin head
  // base(href='/') // Let's not specify a base.
  meta(charset='utf-8')
  meta(http-equiv="Content-Type", content="text/html; charset=UTF-8")
  meta(http-equiv='X-UA-Compatible', content='IE=edge')
  meta(name='viewport', content='width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=0')

mixin sidebarmenu
  nav.categories-menu
    ul(aria-labelledby='heading-categories-menu', role='menu').nav.dropdown-menu-right
  .gray-overlay

mixin recursiveCategoryItem(catalog, category)
  if category.count > 0
    li
      if category.children.length > 0
        span
          a.col-xs-10(href='/#{catalog.alias}?cat=#{category.id}') #{category.name}
            span  #{category.count}
          a.col-xs-2.expand-menu(href='')
            +icon('icon-plus-minus')
        ul.nav.menu-hidden
          each childCategory in category.children
            +recursiveCategoryItem(catalog, childCategory)
      else
        a.col-xs-12(href='/#{catalog.alias}?cat=#{category.id}') #{category.name}
          span  #{category.count}

mixin footer
  footer
    .footer
      .container
        .row
          h4.footer-title Om Nationalmuseets Samlinger Online
          address.col-xs-12
            span Nationalmuseet
            span Prinsens Palæ
            span Ny Vestergade 10
            span DK-1471 København K
            span Tel. +45 3313 4411
        .row
          .col-xs-12
            h2.h4 Følg os på:
            p.social-links
              a(href='https://www.facebook.com/nationalmuseet')
                span.sr-only Facebook
                +icon('icon-facebook')
              a(href='https://twitter.com/Nationalmuseet')
                span.sr-only Twitter
                +icon('icon-twitter')
              a(href='http://www.youtube.com/user/natmusdk')
                span.sr-only YouTube
                +icon('icon-youtube')

mixin icon(id)
  case id
    when 'pencil-icon'
      svg.pencil-icon
        use(xlink:href='#icon-pencil')
    when 'icon-menu'
      svg
        use(xlink:href='#icon-menu')
    when 'icon-logo'
      svg
        use(xlink:href='#icon-logo')
    when 'icon-download'
      svg
        use(xlink:href='#icon-download')
    when 'icon-share'
      svg
        use(xlink:href='#icon-share')
    when 'icon-plus-minus'
      svg
        use(xlink:href='#icon-plus')
    when 'icon-minus'
      svg.icon-minus
        use(xlink:href='#icon-minus')
    when 'icon-plus'
      svg.icon-plus
        use(xlink:href='#icon-plus')
    when 'icon-facebook'
      svg
        use(xlink:href='#icon-facebook')
    when 'icon-twitter'
      svg
        use(xlink:href='#icon-twitter')
    when 'icon-youtube'
      svg
        use(xlink:href='#icon-youtube')
    when 'icon-search'
      svg
        use(xlink:href='#icon-search')
    default
      span #{id} is not a valid icon ID

mixin responsiveImage(title, item, sources)
  img(src=sources.image, alt=title)

  if(item.license)
    var license = helpers.license_tag(item.license.id);
    if(license)
      a(href=license.url, rel='license', class='hidden') Creative Commons Navngivelse 2.5

mixin rotationImage(title, item, sources)
  picture(alt=title)
    //[if IE 9]><video style="display: none;"><![endif]
    source(srcset=sources.image_set['2000'], media='(min-width: 1200px)')
    source(srcset=sources.image_set['1200'], media='(min-width: 800px)')
    source(srcset=sources.image_set['800'], media='(min-width: 400px)')
    source(srcset=sources.image_set['400'], media='(max-width: 400px)')
    //[if IE 9]></video><![endif]
    a.Magic360(data-magic360-options=helpers.magic360_options(sources.image_rotation_set))
      img(src=sources.image, alt=title)

  if(item.license)
    var license = helpers.license_tag(item.license.id);
    if(license)
      a(href=license.url, rel='license', class='hidden') Creative Commons Navngivelse 2.5

mixin shareThisHTML()
  .btn-group.dropup
    a(data-toggle='dropdown', data-target='#', href='./').dropdown-toggle.btn.btn-default Del
      +icon('icon-share')
    ul.dropdown-menu(role='menu')
      li.st_facebook(displayText='Facebook')
      li.divider
      li.st_twitter(displayText='Twitter')
      li.divider
      li.st_pinterest(displayText='Pinterest')
      li.divider
      li.st_email(displayText='Email')

mixin shareThisJS()
  <script type="text/javascript">var switchTo5x=true;</script>
  <script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
  <script type="text/javascript">stLight.options({publisher: "1151a286-82a8-4988-9f00-6de37128d9d6", doNotHash: false, doNotCopy: false, hashAddressBar: false});</script>

mixin formatDate(from, to)
  if(from && to && from.day == to.day && from.month == to.month && from.day == to.day)
    | #{from.day}/#{from.month}/#{from.year}
  else
    if(from && to && from.day == 1 && from.month == 1 && to.day == 31 && to.month == 12 && from.year == to.year)
      | #{from.year}
    else
      if(from)
        | #{from.day}/#{from.month}/#{from.year}
      if((from && to) || (!from && !to))
        |  - 
      if(to)
        | #{to.day}/#{to.month}/#{to.year}

mixin addDating(item, alias)
  - var leaf_category = helpers.leaf_category_by_tag(categories, 'Tid');
  if(leaf_category)
    a(href=helpers.get_category_link(req, alias, leaf_category))= leaf_category.name
  else
    | -

mixin addPlace(item, alias)
  - var leaf_category = helpers.leaf_category_by_tag(categories, 'Lokalitet');
  if(leaf_category)
    a(href=helpers.get_category_link(req, alias, leaf_category))= leaf_category.name
  else
    | -

mixin searchMeta(results, catalog, breadcrumbs)
  - siteTitle = req.app.get('site_title');
  - baseUrl = 'http://' + (req.get('x-forwarded-host') || req.get('host'));
  if results.is_search
    - title= 'Søgning på "' + filters.freetext +   '" (' + results.total_results + ' poster) - ' + siteTitle
    title #{title}
    meta(property="og:title", content="#{title}")
    meta(itemprop="name", content="#{title}")
    meta(name="twitter:title", content="#{title}")
    meta(property="og:url", content="#{baseUrl}/?q=#{freetext}")
  if results.is_front
    title Nationalmuseets Samlinger Online (#{results.total_results} poster) - #{siteTitle}
    meta(property="og:title", content="Søg og udforsk Nationalmuseets Samlinger i alt #{results.total_results} poster - " + siteTitle)
    meta(itemprop="name", content="Søg og udforsk Nationalmuseets Samlinger i alt #{results.total_results} poster - " + siteTitle)
    meta(name="twitter:title", content="Søg og udforsk Nationalmuseets Samlinger i alt #{results.total_results} poster - " + siteTitle)
    meta(property="og:url", content="#{baseUrl}")

  if results.is_category
    if breadcrumbs
      if breadcrumbs.second
        title #{catalog.name} &gt; #{breadcrumbs.first.name} &gt; #{breadcrumbs.second.name} (#{results.total_results} poster) - #{siteTitle}
        - title= catalog.name + " > " + breadcrumbs.first.name + " > " + breadcrumbs.second.name + " (" + results.total_results + " poster) > " + " - " + siteTitle
        meta(property="og:title", content="#{title}")
        meta(itemprop="name", content="#{title}")
        meta(name="twitter:title", content="#{title}")
        meta(property="og:url", content="#{baseUrl}/#{catalog.alias}?cat=#{breadcrumbs.second.id}")
      else
        title #{catalog.name} &gt; #{breadcrumbs.first.name} (#{results.total_results} poster) - #{siteTitle}
        - title= catalog.name + " > " + breadcrumbs.first.name + " (" + results.total_results + " poster) " + " - " + siteTitle
        meta(property="og:title", content="#{title}")
        meta(itemprop="name", content="#{title}")
        meta(name="twitter:title", content="#{title}")
        meta(property="og:url", content="#{baseUrl}/#{catalog.alias}?cat=#{breadcrumbs.first.id}")
    else
      title #{catalog.name} &gt; Ingen titel - #{siteTitle}
      meta(property="og:title", content="Ingen titel - #{catalog.name}")
      meta(itemprop="name", content="Ingen titel - #{catalog.name}")
      meta(name="twitter:title", content="Ingen titel - #{catalog.name}")


  if results.is_catalog
    title #{catalog.name} (#{results.total_results} poster) - #{siteTitle}
    meta(property="og:title", content="#{catalog.name} (#{results.total_results} poster) - #{siteTitle}")
    meta(itemprop="name", content="#{catalog.name} (#{results.total_results} poster) - #{siteTitle}")
    meta(name="twitter:title", content="#{catalog.name} (#{results.total_results} poster) - #{siteTitle}")
    meta(property="og:url", content="#{baseUrl}/#{catalog.alias}")

  //- Default for all search pages
  meta(property="og:type", content="website")
  meta(property="og:site_name", content=siteTitle)
  meta(property="og:image", content="#{baseUrl}/images/defaultshare.jpg")
  meta(itemprop="image", content="#{baseUrl}/images/defaultshare.jpg")
  meta(name="twitter:card",content="summary")
  meta(name="twitter:site", content="@Nationalmuseet")
  meta(name="twitter:creator", content="@Nationalmuseet")
  meta(name="twitter:url", content="https://twitter.com/Nationalmuseet")

mixin assetMeta(item, sources)
  // Nothing

mixin searchResultAsset(asset)
  div(class='col-lg-3 box')
    .thumbnail
      a(href='#{asset.url}')
        if asset.type == 'video'
          div.video-thumbnail
            div.icon
        else
          div.image
            div.overlay
              img(src='#{asset.thumbnail_url}')
              if asset.type == 'image-rotation'
                img(src="/images/rotation-icon.svg", class="rotation-icon")
        if asset.title
          h2.h4 #{asset.title}
        else
          h2(class='h4') Ingen titel
        p.description #{asset.description}
      p.cat-link
        a(href='#{asset.catalog_url}') #{asset.catalog}

mixin assetIcon(small)
  if small
    span.asset-icon.glyphicon.glyphicon-picture.small
  else
    span.asset-icon.glyphicon.glyphicon-picture
