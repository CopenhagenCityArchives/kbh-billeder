extends index

append header
  +searchMeta(result, catalog, breadcrumbs)
    
block content

  section.search-page__filtering
    .container-fluid
      each filter, filterKey in filterOptions
        - var currentChoice = filters.params.filters[filterKey] || false
        .dropdown
          a.dropdown__selected(
            class=currentChoice ? '' : 'dropdown__selected--not-bold') 
            if currentChoice
              if currentChoice.label
                = currentChoice.label
              else
                = filter.options[currentChoice].label
            else 
              = filter.label
          .dropdown__options
            if filter.notSelectedLabel
              - var noFilterUrl = helpers.urlQuery(fullPath, filterKey, undefined)
              - if (filter.type === 'catalog') {
              -   noFilterUrl = '/' + queryUrl
              - }
              a.dropdown__option(href=noFilterUrl, 
                class=!currentChoice ? 'dropdown__option--active' : '') 
                  | #{filter.notSelectedLabel} 

            if filter.options
              each option, key in filter.options
                - var selected = key === currentChoice
                - var url = helpers.urlQuery(fullPath, filterKey, key)
                - if (filter.type === 'catalog') { url = key + queryUrl }
                a.dropdown__option(href=url, 
                  class=selected ? 'dropdown__option--active' : '') #{option.label} 

            if filter.option && filter.option.type === 'date-range'
              .form-group
                form(method='get', data-method='modify-query')
                  label(for='#{filterKey}-from-date') Fra dato
                  input(type='date', name='#{filterKey}-from', 
                    id='#{filterKey}-from-date', value=currentChoice.from
                    placeholder='fx 24/12/1849').form-control
                  label(for='#{filterKey}-to-date') Til dato
                  input(type='date', name='#{filterKey}-to', 
                    id='#{filterKey}-to-date', value=currentChoice.to
                    placeholder='fx 24/12/1945').form-control
                  button.btn.btn-block.btn-primary(type='submit') Filtrér

  include includes/translate
  
  .let-it-grow
    section.container-fluid
      .search-page__header.row 

        h1.col-xs-12.col-sm-7.col-md-8.col-lg-8
          if result.isSearch
            if filters.freetext
              | Søgning på "#{filters.freetext}"
            else
              | Filtrering gav
            +searchCount
          if result.isCategory
            a.breadcrumbs-link.dark(href='/#{catalog.alias}') #{catalog.name}
            if breadcrumbs
              if breadcrumbs.second
                | &nbsp; &gt; &nbsp;
                a.breadcrumbs-link(href='/#{catalog.alias}?cat=#{breadcrumbs.first.id}') #{breadcrumbs.first.name}
                | &nbsp; &gt; &nbsp;
                span #{breadcrumbs.second.name}
                  +searchCount
              else if breadcrumbs.first
                | &nbsp; &gt; &nbsp;
                span #{breadcrumbs.first.name}
                  +searchCount
            else
              +searchCount


          if result.isCatalog
            | #{catalog.name}
            +searchCount

        .search-page__sorting.col-xs-12.col-sm-5.col-md-4.col-lg-4
          | Sorteret efter
          .dropdown
            a.dropdown__selected= sortOptions[sorting].label
            .dropdown__options
              each val, key in sortOptions
                - var selected = (key === sorting)
                - var url = helpers.urlQuery(fullPath, 'sort', key)
                a.dropdown__option(href=url, 
                  class=selected ? 'dropdown__option--active' : '') #{val.label} 

      .search-results.row(id="masonry-container")
        each asset in result.hits
          +searchResultAsset(asset)

  .clearfix
  
  #page-nav
    a(href='#{infinitepath}')

  if(result.totalCountRaw > 10)
    button.btn.btn-primary.btn-lg.load-more(data-action="load-more")
      +loader('Vis flere...')
      
  a#toTop
    +icon('scrolltotop')

  include includes/footer

append javascript
  script.
    $(function() {
      $('#toTop').scrollToTop(400);
      // To ensure no boxes are hidden if the was some load error
      $('.loaded-more').removeClass('loaded-more');
    });
