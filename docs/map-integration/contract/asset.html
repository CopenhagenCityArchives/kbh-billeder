<!DOCTYPE html>
<html>
<head>
    <title>Map Search documentation</title>

    <link rel="stylesheet" href="single.css" type="text/css"/>
    <link rel="stylesheet" href="map.css" type="text/css"/>

    <script src="../../../app/scripts/ol.js"></script>
    <script src="../../../app/scripts/historisk-atlas.js"></script>
    <script language="JavaScript">
      //fake node module loading
      var module = {exports: {}};
    </script>
    <script src="../../../app/scripts-browserify/map-controller.js"></script>
    <script language="JavaScript">
      (function () {
        var _currentSearchResult = [];

        var _mockedSearchController = {
          // Called by the map controller prior to triggering a new search.
          getCurrentSearchParameters: function () {
            return {};
          },

          // Mocked search function, called by the map controller when HA changes.
          refresh: function () {

            var xhr = new XMLHttpRequest();
            xhr.open('GET', 'asset-single-asset.json', true);
            xhr.setRequestHeader('Content-Type', 'application/json; charset=utf-8');
            xhr.onload = function (e) {
              _currentSearchResult = JSON.parse(xhr.responseText);
              mapController.onResults([_currentSearchResult]);
            };
            xhr.send(null);
          }
        };

        var mapController;
        window.onload = function () {
          var options = {
            mode: 'single',
            center: [12.35760, 55.71490],
            zoomLevel: 16,
            icons: {
              asset: '/app/images/icons/map/pinselected.png',
              assetHeading: '/app/images/icons/map/pinheadingselected.png',
              assetEdit: '/app/images/icons/map/pinedit.png',
              assetHeadingEdit: '/app/images/icons/map/pinheadingedit.png',
              camera: '/app/images/icons/map/camera.png',
              target: '/app/images/icons/map/pintarget.png',
              image: '/app/images/icons/map/image.png'
            },
            // Provide a mock mapper that just passes the results through.
            // In the live setup results would come from ES and require mapping
            // but as we're testing against a "contract" dataset, our results
            // has already been mapped.
            assetMapper: function(results) {
              return results;
            }
          };

          mapController = MapController(document.getElementById('map'), _mockedSearchController, options);

          document.getElementById('toggleedit').onclick = function () {
            var asset = mapController.toggleEditMode();
            console.log("updated coordinates: " + asset.latitude + " , " + asset.longitude);
            console.log("updated heading: " + asset.heading);
          };

          // Trigger an initial refresh to load the map.
          _mockedSearchController.refresh();
        };
      })();
    </script>
    <style>
        #map {
            width: 1000px;
            height: 600px;
        }
    </style>
</head>
<body>

    <div id="map"></div>
    <br>
    <input type="button" id="toggleedit" value="Toggle edit mode" />

</body>
</html>
